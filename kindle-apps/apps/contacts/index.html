<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contacts - Kindle App</title>
    <style>
        :root {
            --background-color: #ffffff;
            --text-color: #000000;
            --border-color: #000000;
            --muted-color: #333333;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            padding: 20px;
            min-height: 100vh;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border-color);
        }

        h1 {
            font-size: 24px;
        }

        .back-link {
            text-decoration: none;
            color: var(--text-color);
            border: 2px solid var(--border-color);
            padding: 8px 16px;
            font-size: 14px;
            font-weight: bold;
        }

        .back-link:hover {
            background-color: var(--text-color);
            color: var(--background-color);
        }

        /* List View */
        .contact-list-view {
            display: block;
        }

        .search-bar {
            margin-bottom: 15px;
        }

        .search-bar input {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border-color);
            font-size: 16px;
            background-color: var(--background-color);
            color: var(--text-color);
        }

        .add-contact-btn {
            width: 100%;
            padding: 15px;
            border: 2px solid var(--border-color);
            background-color: var(--text-color);
            color: var(--background-color);
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 20px;
        }

        .add-contact-btn:hover {
            background-color: var(--background-color);
            color: var(--text-color);
        }

        .contacts-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .contact-item {
            border: 2px solid var(--border-color);
            padding: 15px;
            cursor: pointer;
        }

        .contact-item:hover {
            background-color: var(--text-color);
            color: var(--background-color);
        }

        .contact-name {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .contact-preview {
            font-size: 14px;
            color: var(--muted-color);
        }

        .contact-item:hover .contact-preview {
            color: var(--background-color);
            opacity: 0.8;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: var(--muted-color);
            border: 2px solid var(--border-color);
        }

        /* Editor View */
        .contact-editor-view {
            display: none;
        }

        .editor-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .editor-btn {
            padding: 10px 20px;
            border: 2px solid var(--border-color);
            background-color: var(--background-color);
            color: var(--text-color);
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
        }

        .editor-btn:hover {
            background-color: var(--text-color);
            color: var(--background-color);
        }

        .editor-btn.primary {
            background-color: var(--text-color);
            color: var(--background-color);
        }

        .editor-btn.primary:hover {
            background-color: var(--background-color);
            color: var(--text-color);
        }

        .editor-btn.delete {
            margin-left: auto;
        }

        .contact-form {
            border: 2px solid var(--border-color);
            padding: 20px;
        }

        .form-section {
            margin-bottom: 20px;
        }

        .form-section:last-child {
            margin-bottom: 0;
        }

        .form-section h3 {
            font-size: 16px;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border-color);
        }

        .form-field {
            margin-bottom: 12px;
        }

        .form-field label {
            display: block;
            font-size: 14px;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-field input, .form-field textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid var(--border-color);
            font-family: Arial, sans-serif;
            font-size: 16px;
            background-color: var(--background-color);
            color: var(--text-color);
        }

        .form-field textarea {
            min-height: 80px;
            resize: vertical;
        }

        .form-field input:focus, .form-field textarea:focus {
            outline: none;
        }

        @media (max-width: 640px) {
            .editor-controls {
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Contacts</h1>
        <a href="../../index.html" class="back-link">← Dashboard</a>
    </div>

    <!-- List View -->
    <div class="contact-list-view" id="contact-list-view">
        <div class="search-bar">
            <input type="text" id="search-input" placeholder="Search contacts...">
        </div>
        <button class="add-contact-btn" id="add-contact-btn">+ New Contact</button>
        <div class="contacts-list" id="contacts-list"></div>
    </div>

    <!-- Editor View -->
    <div class="contact-editor-view" id="contact-editor-view">
        <div class="editor-controls">
            <button class="editor-btn" id="back-to-list-btn">← Back</button>
            <button class="editor-btn primary" id="save-contact-btn">Save</button>
            <button class="editor-btn delete" id="delete-contact-btn">Delete</button>
        </div>

        <div class="contact-form">
            <div class="form-section">
                <h3>Basic Information</h3>
                <div class="form-field">
                    <label>Name *</label>
                    <input type="text" id="contact-name" required>
                </div>
                <div class="form-field">
                    <label>Nickname</label>
                    <input type="text" id="contact-nickname">
                </div>
            </div>

            <div class="form-section">
                <h3>Contact Details</h3>
                <div class="form-field">
                    <label>Phone Number</label>
                    <input type="tel" id="contact-phone">
                </div>
                <div class="form-field">
                    <label>Email Address</label>
                    <input type="email" id="contact-email">
                </div>
            </div>

            <div class="form-section">
                <h3>Address</h3>
                <div class="form-field">
                    <label>Street Address</label>
                    <textarea id="contact-address"></textarea>
                </div>
            </div>

            <div class="form-section">
                <h3>Social Media</h3>
                <div class="form-field">
                    <label>Twitter/X</label>
                    <input type="text" id="contact-twitter" placeholder="@username">
                </div>
                <div class="form-field">
                    <label>Instagram</label>
                    <input type="text" id="contact-instagram" placeholder="@username">
                </div>
                <div class="form-field">
                    <label>LinkedIn</label>
                    <input type="text" id="contact-linkedin" placeholder="linkedin.com/in/username">
                </div>
                <div class="form-field">
                    <label>Other Social</label>
                    <input type="text" id="contact-other-social" placeholder="Platform: @username">
                </div>
            </div>

            <div class="form-section">
                <h3>Notes</h3>
                <div class="form-field">
                    <textarea id="contact-notes" placeholder="Additional notes about this contact..."></textarea>
                </div>
            </div>
        </div>
    </div>

    <script src="../../settings.js"></script>
    <script>
        const STORAGE_KEY = 'kindle-contacts';
        let contacts = [];
        let currentContactId = null;

        // Load contacts
        function loadContacts() {
            try {
                const stored = localStorage.getItem(STORAGE_KEY);
                if (stored) {
                    contacts = JSON.parse(stored);
                }
            } catch (e) {
                console.error('Error loading contacts:', e);
                contacts = [];
            }
        }

        // Save contacts
        function saveContacts() {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(contacts));
            } catch (e) {
                console.error('Error saving contacts:', e);
            }
        }

        // Render contact list
        function renderContactList(searchTerm = '') {
            const listEl = document.getElementById('contacts-list');
            listEl.innerHTML = '';

            let filteredContacts = contacts;
            
            if (searchTerm) {
                const term = searchTerm.toLowerCase();
                filteredContacts = contacts.filter(c => 
                    c.name.toLowerCase().includes(term) ||
                    (c.nickname && c.nickname.toLowerCase().includes(term)) ||
                    (c.phone && c.phone.includes(term)) ||
                    (c.email && c.email.toLowerCase().includes(term))
                );
            }

            if (filteredContacts.length === 0) {
                listEl.innerHTML = searchTerm 
                    ? '<div class="empty-state">No contacts found.</div>'
                    : '<div class="empty-state">No contacts yet. Add one to get started!</div>';
                return;
            }

            // Sort alphabetically
            filteredContacts.sort((a, b) => a.name.localeCompare(b.name));

            filteredContacts.forEach(contact => {
                const contactDiv = document.createElement('div');
                contactDiv.className = 'contact-item';
                contactDiv.onclick = () => openContact(contact.id);

                const preview = [];
                if (contact.phone) preview.push(contact.phone);
                if (contact.email) preview.push(contact.email);

                contactDiv.innerHTML = `
                    <div class="contact-name">${escapeHtml(contact.name)}${contact.nickname ? ' (' + escapeHtml(contact.nickname) + ')' : ''}</div>
                    <div class="contact-preview">${escapeHtml(preview.join(' • '))}</div>
                `;

                listEl.appendChild(contactDiv);
            });
        }

        // Show list view
        function showListView() {
            document.getElementById('contact-list-view').style.display = 'block';
            document.getElementById('contact-editor-view').style.display = 'none';
            currentContactId = null;
            renderContactList(document.getElementById('search-input').value);
        }

        // Show editor view
        function showEditorView() {
            document.getElementById('contact-list-view').style.display = 'none';
            document.getElementById('contact-editor-view').style.display = 'block';
        }

        // Create new contact
        function createNewContact() {
            const newContact = {
                id: Date.now(),
                name: '',
                nickname: '',
                phone: '',
                email: '',
                address: '',
                twitter: '',
                instagram: '',
                linkedin: '',
                otherSocial: '',
                notes: '',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            contacts.push(newContact);
            saveContacts();
            openContact(newContact.id);
        }

        // Open contact for editing
        function openContact(id) {
            currentContactId = id;
            const contact = contacts.find(c => c.id === id);
            
            if (!contact) {
                showListView();
                return;
            }

            document.getElementById('contact-name').value = contact.name || '';
            document.getElementById('contact-nickname').value = contact.nickname || '';
            document.getElementById('contact-phone').value = contact.phone || '';
            document.getElementById('contact-email').value = contact.email || '';
            document.getElementById('contact-address').value = contact.address || '';
            document.getElementById('contact-twitter').value = contact.twitter || '';
            document.getElementById('contact-instagram').value = contact.instagram || '';
            document.getElementById('contact-linkedin').value = contact.linkedin || '';
            document.getElementById('contact-other-social').value = contact.otherSocial || '';
            document.getElementById('contact-notes').value = contact.notes || '';
            
            showEditorView();
        }

        // Save current contact
        function saveCurrentContact() {
            if (!currentContactId) return;

            const contact = contacts.find(c => c.id === currentContactId);
            if (!contact) return;

            const name = document.getElementById('contact-name').value.trim();
            if (!name) {
                alert('Name is required');
                return;
            }

            contact.name = name;
            contact.nickname = document.getElementById('contact-nickname').value.trim();
            contact.phone = document.getElementById('contact-phone').value.trim();
            contact.email = document.getElementById('contact-email').value.trim();
            contact.address = document.getElementById('contact-address').value.trim();
            contact.twitter = document.getElementById('contact-twitter').value.trim();
            contact.instagram = document.getElementById('contact-instagram').value.trim();
            contact.linkedin = document.getElementById('contact-linkedin').value.trim();
            contact.otherSocial = document.getElementById('contact-other-social').value.trim();
            contact.notes = document.getElementById('contact-notes').value.trim();
            contact.updatedAt = new Date().toISOString();

            saveContacts();
            showListView();
        }

        // Delete current contact
        function deleteCurrentContact() {
            if (!currentContactId) return;

            if (confirm('Are you sure you want to delete this contact?')) {
                contacts = contacts.filter(c => c.id !== currentContactId);
                saveContacts();
                showListView();
            }
        }

        // Escape HTML
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Event listeners
        document.getElementById('add-contact-btn').addEventListener('click', createNewContact);
        document.getElementById('back-to-list-btn').addEventListener('click', showListView);
        document.getElementById('save-contact-btn').addEventListener('click', saveCurrentContact);
        document.getElementById('delete-contact-btn').addEventListener('click', deleteCurrentContact);
        document.getElementById('search-input').addEventListener('input', (e) => {
            renderContactList(e.target.value);
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            settingsManager.applyTheme();
            loadContacts();
            showListView();
        });
    </script>
</body>
</html>
