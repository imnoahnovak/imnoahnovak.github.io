<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timer - Kindle App</title>
    <style>
        :root {
            --background-color: #ffffff;
            --text-color: #000000;
            --border-color: #000000;
            --muted-color: #333333;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            padding: 20px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border-color);
        }

        h1 {
            font-size: 24px;
        }

        .back-link {
            text-decoration: none;
            color: var(--text-color);
            border: 2px solid var(--border-color);
            padding: 8px 16px;
            font-size: 14px;
            font-weight: bold;
        }

        .back-link:hover {
            background-color: var(--text-color);
            color: var(--background-color);
        }

        .add-timer-btn {
            width: 100%;
            padding: 15px;
            border: 2px solid var(--border-color);
            background-color: var(--text-color);
            color: var(--background-color);
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 20px;
        }

        .add-timer-btn:hover {
            background-color: var(--background-color);
            color: var(--text-color);
        }

        .timers-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .timer-item {
            border: 2px solid var(--border-color);
            padding: 20px;
        }

        .timer-item.completed {
            animation: flash 1s infinite;
        }

        @keyframes flash {
            0%, 100% { background-color: var(--background-color); }
            50% { background-color: var(--text-color); color: var(--background-color); }
        }

        .timer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .timer-name {
            font-size: 18px;
            font-weight: bold;
        }

        .timer-delete {
            padding: 8px 12px;
            border: 2px solid var(--border-color);
            background-color: var(--background-color);
            color: var(--text-color);
            font-size: 14px;
            cursor: pointer;
        }

        .timer-delete:hover {
            background-color: var(--text-color);
            color: var(--background-color);
        }

        .timer-display {
            font-size: 48px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 15px;
        }

        .timer-inputs {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 15px;
        }

        .timer-input {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .timer-input label {
            font-size: 12px;
            margin-bottom: 5px;
            color: var(--muted-color);
        }

        .timer-input input {
            width: 60px;
            padding: 8px;
            border: 2px solid var(--border-color);
            font-size: 18px;
            text-align: center;
            background-color: var(--background-color);
            color: var(--text-color);
        }

        .timer-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .timer-btn {
            padding: 12px 24px;
            border: 2px solid var(--border-color);
            background-color: var(--text-color);
            color: var(--background-color);
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
        }

        .timer-btn:hover:not(:disabled) {
            background-color: var(--background-color);
            color: var(--text-color);
        }

        .timer-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .timer-btn.secondary {
            background-color: var(--background-color);
            color: var(--text-color);
        }

        .timer-btn.secondary:hover {
            background-color: var(--text-color);
            color: var(--background-color);
        }

        .timer-status {
            text-align: center;
            margin-top: 10px;
            font-size: 14px;
            color: var(--muted-color);
        }

        .presets {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            margin-top: 10px;
        }

        .preset-btn {
            padding: 8px 12px;
            border: 2px solid var(--border-color);
            background-color: var(--background-color);
            color: var(--text-color);
            font-size: 12px;
            cursor: pointer;
        }

        .preset-btn:hover {
            background-color: var(--text-color);
            color: var(--background-color);
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: var(--muted-color);
            border: 2px solid var(--border-color);
        }

        @media (max-width: 640px) {
            .timer-display {
                font-size: 36px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Timers</h1>
        <a href="../../index.html" class="back-link">← Dashboard</a>
    </div>

    <button class="add-timer-btn" id="add-timer-btn">+ Add Timer</button>

    <div class="timers-list" id="timers-list"></div>

    <script src="../../settings.js"></script>
    <script>
        let timers = [];
        let timerIntervals = {};

        // Timer class
        class Timer {
            constructor(id, name = 'Timer') {
                this.id = id;
                this.name = name;
                this.totalSeconds = 0;
                this.remainingSeconds = 0;
                this.isRunning = false;
                this.isCompleted = false;
            }
        }

        // Add new timer
        function addTimer() {
            const timer = new Timer(Date.now(), `Timer ${timers.length + 1}`);
            timers.push(timer);
            renderTimers();
        }

        // Delete timer
        function deleteTimer(id) {
            if (confirm('Delete this timer?')) {
                stopTimer(id);
                timers = timers.filter(t => t.id !== id);
                renderTimers();
            }
        }

        // Start/pause timer
        function toggleTimer(id) {
            const timer = timers.find(t => t.id === id);
            if (!timer) return;

            if (!timer.isRunning) {
                // Start or resume
                if (timer.remainingSeconds === 0) {
                    // Get time from inputs
                    const hours = parseInt(document.getElementById(`hours-${id}`).value) || 0;
                    const minutes = parseInt(document.getElementById(`minutes-${id}`).value) || 0;
                    const seconds = parseInt(document.getElementById(`seconds-${id}`).value) || 0;
                    timer.totalSeconds = hours * 3600 + minutes * 60 + seconds;
                    timer.remainingSeconds = timer.totalSeconds;
                    
                    if (timer.remainingSeconds === 0) {
                        return;
                    }
                }
                
                timer.isRunning = true;
                timer.isCompleted = false;
                
                timerIntervals[id] = setInterval(() => {
                    if (timer.remainingSeconds > 0) {
                        timer.remainingSeconds--;
                        updateTimerDisplay(id);
                    } else {
                        completeTimer(id);
                    }
                }, 1000);
            } else {
                // Pause
                timer.isRunning = false;
                clearInterval(timerIntervals[id]);
            }
            
            renderTimers();
        }

        // Stop and reset timer
        function stopTimer(id) {
            const timer = timers.find(t => t.id === id);
            if (!timer) return;

            timer.isRunning = false;
            timer.isCompleted = false;
            timer.remainingSeconds = 0;
            clearInterval(timerIntervals[id]);
            renderTimers();
        }

        // Complete timer
        function completeTimer(id) {
            const timer = timers.find(t => t.id === id);
            if (!timer) return;

            timer.isRunning = false;
            timer.isCompleted = true;
            timer.remainingSeconds = 0;
            clearInterval(timerIntervals[id]);
            renderTimers();
        }

        // Update timer display
        function updateTimerDisplay(id) {
            const timer = timers.find(t => t.id === id);
            if (!timer) return;

            const displayEl = document.getElementById(`display-${id}`);
            if (displayEl) {
                displayEl.textContent = formatTime(timer.remainingSeconds);
            }
        }

        // Format time as HH:MM:SS
        function formatTime(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            return String(hours).padStart(2, '0') + ':' +
                   String(minutes).padStart(2, '0') + ':' +
                   String(secs).padStart(2, '0');
        }

        // Set preset time
        function setPreset(id, hours, minutes, seconds) {
            document.getElementById(`hours-${id}`).value = hours;
            document.getElementById(`minutes-${id}`).value = minutes;
            document.getElementById(`seconds-${id}`).value = seconds;
        }

        // Render all timers
        function renderTimers() {
            const listEl = document.getElementById('timers-list');
            listEl.innerHTML = '';

            if (timers.length === 0) {
                listEl.innerHTML = '<div class="empty-state">No timers yet. Add one to get started!</div>';
                return;
            }

            timers.forEach(timer => {
                const timerDiv = document.createElement('div');
                timerDiv.className = 'timer-item' + (timer.isCompleted ? ' completed' : '');
                timerDiv.id = `timer-${timer.id}`;

                const statusText = timer.isCompleted ? "Time's up! ⏰" :
                                 timer.isRunning ? 'Running...' :
                                 timer.remainingSeconds > 0 ? 'Paused' :
                                 'Set your time';

                timerDiv.innerHTML = `
                    <div class="timer-header">
                        <div class="timer-name">${escapeHtml(timer.name)}</div>
                        <button class="timer-delete" data-id="${timer.id}">Delete</button>
                    </div>
                    
                    <div class="timer-display" id="display-${timer.id}">${formatTime(timer.remainingSeconds)}</div>
                    
                    <div class="timer-status">${statusText}</div>
                    
                    ${!timer.isRunning && timer.remainingSeconds === 0 && !timer.isCompleted ? `
                        <div class="timer-inputs">
                            <div class="timer-input">
                                <label>Hours</label>
                                <input type="number" id="hours-${timer.id}" min="0" max="23" value="0">
                            </div>
                            <div class="timer-input">
                                <label>Minutes</label>
                                <input type="number" id="minutes-${timer.id}" min="0" max="59" value="5">
                            </div>
                            <div class="timer-input">
                                <label>Seconds</label>
                                <input type="number" id="seconds-${timer.id}" min="0" max="59" value="0">
                            </div>
                        </div>
                        
                        <div class="presets">
                            <button class="preset-btn" data-id="${timer.id}" data-hours="0" data-minutes="1" data-seconds="0">1 min</button>
                            <button class="preset-btn" data-id="${timer.id}" data-hours="0" data-minutes="5" data-seconds="0">5 min</button>
                            <button class="preset-btn" data-id="${timer.id}" data-hours="0" data-minutes="10" data-seconds="0">10 min</button>
                            <button class="preset-btn" data-id="${timer.id}" data-hours="0" data-minutes="15" data-seconds="0">15 min</button>
                            <button class="preset-btn" data-id="${timer.id}" data-hours="0" data-minutes="30" data-seconds="0">30 min</button>
                            <button class="preset-btn" data-id="${timer.id}" data-hours="1" data-minutes="0" data-seconds="0">1 hour</button>
                        </div>
                    ` : ''}
                    
                    <div class="timer-controls">
                        <button class="timer-btn timer-toggle" data-id="${timer.id}">
                            ${timer.isRunning ? 'Pause' : timer.remainingSeconds > 0 ? 'Resume' : 'Start'}
                        </button>
                        ${timer.remainingSeconds > 0 || timer.isCompleted ? `
                            <button class="timer-btn secondary timer-stop" data-id="${timer.id}">Reset</button>
                        ` : ''}
                    </div>
                `;

                listEl.appendChild(timerDiv);
            });
        }

        // Escape HTML
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Event listeners
        document.getElementById('add-timer-btn').addEventListener('click', addTimer);

        // Event delegation for timer list
        document.getElementById('timers-list').addEventListener('click', (e) => {
            const target = e.target;
            
            // Handle delete button clicks
            if (target.classList.contains('timer-delete')) {
                const id = parseInt(target.getAttribute('data-id'), 10);
                if (id) {
                    deleteTimer(id);
                }
            }
            // Handle toggle (start/pause/resume) button clicks
            else if (target.classList.contains('timer-toggle')) {
                const id = parseInt(target.getAttribute('data-id'), 10);
                if (id) {
                    toggleTimer(id);
                }
            }
            // Handle stop/reset button clicks
            else if (target.classList.contains('timer-stop')) {
                const id = parseInt(target.getAttribute('data-id'), 10);
                if (id) {
                    stopTimer(id);
                }
            }
            // Handle preset button clicks
            else if (target.classList.contains('preset-btn')) {
                const id = parseInt(target.getAttribute('data-id'), 10);
                const hours = parseInt(target.getAttribute('data-hours'), 10);
                const minutes = parseInt(target.getAttribute('data-minutes'), 10);
                const seconds = parseInt(target.getAttribute('data-seconds'), 10);
                if (id) {
                    setPreset(id, hours, minutes, seconds);
                }
            }
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            settingsManager.applyTheme();
            renderTimers();
        });
    </script>
</body>
</html>
