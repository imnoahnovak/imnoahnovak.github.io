<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Breathing Tool - Kindle App</title>
    <style>
        :root {
            --background-color: #ffffff;
            --text-color: #000000;
            --border-color: #000000;
            --muted-color: #333333;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            padding: 20px;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border-color);
        }

        h1 {
            font-size: 24px;
        }

        .back-link {
            text-decoration: none;
            color: var(--text-color);
            border: 2px solid var(--border-color);
            padding: 8px 16px;
            font-size: 14px;
            font-weight: bold;
        }

        .back-link:hover {
            background-color: var(--text-color);
            color: var(--background-color);
        }

        .breathing-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 30px;
            max-width: 600px;
            margin: 0 auto;
            width: 100%;
        }

        .circle-container {
            position: relative;
            width: 250px;
            height: 250px;
        }

        .breathing-circle {
            width: 100%;
            height: 100%;
            border: 4px solid var(--border-color);
            border-radius: 50%;
            transition: transform 4s ease-in-out;
        }

        .breathing-circle.inhale {
            transform: scale(1.5);
        }

        .breathing-circle.hold {
            transform: scale(1.5);
        }

        .breathing-circle.exhale {
            transform: scale(1);
        }

        .instruction-text {
            font-size: 32px;
            font-weight: bold;
            text-align: center;
            min-height: 50px;
        }

        .timer-text {
            font-size: 48px;
            font-weight: bold;
            text-align: center;
        }

        .technique-selector {
            width: 100%;
            max-width: 400px;
        }

        .technique-selector select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border-color);
            background-color: var(--background-color);
            color: var(--text-color);
            font-size: 16px;
            font-weight: bold;
        }

        .controls {
            display: flex;
            gap: 15px;
        }

        .control-btn {
            padding: 15px 30px;
            border: 2px solid var(--border-color);
            background-color: var(--text-color);
            color: var(--background-color);
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
        }

        .control-btn:hover {
            background-color: var(--background-color);
            color: var(--text-color);
        }

        .control-btn.secondary {
            background-color: var(--background-color);
            color: var(--text-color);
        }

        .control-btn.secondary:hover {
            background-color: var(--text-color);
            color: var(--background-color);
        }

        .technique-info {
            text-align: center;
            padding: 20px;
            border: 2px solid var(--border-color);
            font-size: 14px;
            color: var(--muted-color);
            max-width: 500px;
        }

        @media (max-width: 640px) {
            .circle-container {
                width: 200px;
                height: 200px;
            }

            .instruction-text {
                font-size: 24px;
            }

            .timer-text {
                font-size: 36px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Breathing Tool</h1>
        <a href="../../index.html" class="back-link">‚Üê Dashboard</a>
    </div>

    <div class="breathing-container">
        <div class="technique-selector">
            <select id="technique-select" onchange="changeTechnique()">
                <option value="box">Box Breathing (4-4-4-4)</option>
                <option value="478">4-7-8 Technique</option>
                <option value="calm">Calm Breathing (4-6)</option>
                <option value="energize">Energizing (2-1-4-1)</option>
            </select>
        </div>

        <div class="technique-info" id="technique-info"></div>

        <div class="circle-container">
            <div class="breathing-circle" id="breathing-circle"></div>
        </div>

        <div class="instruction-text" id="instruction-text">Ready to begin</div>
        
        <div class="timer-text" id="timer-text"></div>

        <div class="controls">
            <button class="control-btn" id="start-btn">Start</button>
            <button class="control-btn secondary" id="reset-btn">Reset</button>
        </div>
    </div>

    <script src="../../settings.js"></script>
    <script>
        const techniques = {
            box: {
                name: 'Box Breathing',
                description: 'Equal inhale, hold, exhale, hold. Great for stress relief and focus.',
                pattern: [
                    { phase: 'inhale', duration: 4 },
                    { phase: 'hold', duration: 4 },
                    { phase: 'exhale', duration: 4 },
                    { phase: 'hold', duration: 4 }
                ]
            },
            '478': {
                name: '4-7-8 Technique',
                description: 'Promotes relaxation and helps with sleep. Inhale 4, hold 7, exhale 8.',
                pattern: [
                    { phase: 'inhale', duration: 4 },
                    { phase: 'hold', duration: 7 },
                    { phase: 'exhale', duration: 8 }
                ]
            },
            calm: {
                name: 'Calm Breathing',
                description: 'Simple calming breath. Inhale 4, exhale 6.',
                pattern: [
                    { phase: 'inhale', duration: 4 },
                    { phase: 'exhale', duration: 6 }
                ]
            },
            energize: {
                name: 'Energizing Breath',
                description: 'Quick inhale, brief hold, longer exhale, brief hold. Increases alertness.',
                pattern: [
                    { phase: 'inhale', duration: 2 },
                    { phase: 'hold', duration: 1 },
                    { phase: 'exhale', duration: 4 },
                    { phase: 'hold', duration: 1 }
                ]
            }
        };

        let currentTechnique = 'box';
        let isRunning = false;
        let currentPhaseIndex = 0;
        let currentPhaseTime = 0;
        let breathingInterval = null;

        const circle = document.getElementById('breathing-circle');
        const instructionText = document.getElementById('instruction-text');
        const timerText = document.getElementById('timer-text');
        const startBtn = document.getElementById('start-btn');
        const resetBtn = document.getElementById('reset-btn');

        function changeTechnique() {
            if (isRunning) {
                stopBreathing();
            }
            currentTechnique = document.getElementById('technique-select').value;
            updateTechniqueInfo();
            resetBreathing();
        }

        function updateTechniqueInfo() {
            const info = techniques[currentTechnique];
            document.getElementById('technique-info').innerHTML = `
                <strong>${info.name}</strong><br>
                ${info.description}
            `;
        }

        function startBreathing() {
            if (isRunning) {
                stopBreathing();
                return;
            }

            isRunning = true;
            startBtn.textContent = 'Pause';
            runBreathingCycle();
        }

        function stopBreathing() {
            isRunning = false;
            startBtn.textContent = 'Resume';
            clearInterval(breathingInterval);
        }

        function resetBreathing() {
            stopBreathing();
            currentPhaseIndex = 0;
            currentPhaseTime = 0;
            circle.className = 'breathing-circle';
            instructionText.textContent = 'Ready to begin';
            timerText.textContent = '';
            startBtn.textContent = 'Start';
        }

        function runBreathingCycle() {
            const pattern = techniques[currentTechnique].pattern;
            const currentPhase = pattern[currentPhaseIndex];
            
            currentPhaseTime = currentPhase.duration;
            updateDisplay(currentPhase);
            
            breathingInterval = setInterval(() => {
                currentPhaseTime--;
                timerText.textContent = currentPhaseTime;
                
                if (currentPhaseTime <= 0) {
                    clearInterval(breathingInterval);
                    currentPhaseIndex = (currentPhaseIndex + 1) % pattern.length;
                    
                    if (isRunning) {
                        setTimeout(() => {
                            if (isRunning) {
                                runBreathingCycle();
                            }
                        }, 500);
                    }
                }
            }, 1000);
        }

        function updateDisplay(phase) {
            // Update instruction text
            const phaseText = {
                'inhale': 'Breathe In',
                'hold': 'Hold',
                'exhale': 'Breathe Out'
            };
            instructionText.textContent = phaseText[phase.phase];
            
            // Update circle animation
            circle.className = 'breathing-circle ' + phase.phase;
            
            // Update timer
            timerText.textContent = phase.duration;
        }

        // Event listeners
        startBtn.addEventListener('click', startBreathing);
        resetBtn.addEventListener('click', resetBreathing);

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            settingsManager.applyTheme();
            updateTechniqueInfo();
        });
    </script>
</body>
</html>
